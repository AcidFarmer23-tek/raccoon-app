<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Raccoon Thieves</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* --- STILI GENERALI --- */
        body {
            margin: 0;
            padding: 0;
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: white;
            background-color: #000;
            
            /* Gestione Sfondo */
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            transition: background-image 0.4s ease-in-out; /* Effetto dissolvenza quando cambi stanza */
        }

        /* --- CLASSI PER GLI SFONDI --- */
        .bg-intro  { background-image: url('intro_bg.png'); }
        .bg-covo   { background-image: url('covo_bg.png'); }
        .bg-caveau { background-image: url('caveau_bg.png'); }

        /* --- SCHERMATA INTRO (Iniziale) --- */
        #screen-intro {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100%;
            width: 100%;
        }

        .btn-play {
            background: linear-gradient(90deg, #ad00ff, #6b00ff);
            border: 2px solid rgba(255,255,255,0.3);
            padding: 18px 50px;
            border-radius: 50px;
            color: white;
            font-size: 28px;
            font-weight: 900;
            text-transform: uppercase;
            box-shadow: 0 0 25px #ad00ff;
            cursor: pointer;
            transition: transform 0.1s;
        }
        .btn-play:active { transform: scale(0.95); }

        /* --- SCHERMATA DI GIOCO (Contenitore Principale) --- */
        #screen-game {
            display: none; /* Nascosto all'inizio */
            flex-direction: column;
            height: 100%;
            width: 100%;
        }

        /* Area centrale dove cambia il contenuto */
        .content-area {
            flex-grow: 1;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* Le singole "Viste" (stanze) */
        .view {
            display: none; /* Di base nascoste */
            text-align: center;
            animation: fadeIn 0.5s;
        }
        /* Classe utility per mostrare la vista attiva */
        .view.active-view { display: block; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Titoli delle stanze (opzionale, per capire dove sei) */
        h2.room-title {
            background: rgba(0,0,0,0.6);
            padding: 10px 20px;
            border-radius: 15px;
            border: 1px solid rgba(255,255,255,0.1);
            backdrop-filter: blur(5px);
        }

        /* --- BARRA DI NAVIGAZIONE (Bottom Bar) --- */
        .navbar {
            height: 75px;
            background: rgba(15, 15, 20, 0.95);
            border-top: 2px solid #ad00ff;
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding-bottom: env(safe-area-inset-bottom); /* Per iPhone X+ */
            box-shadow: 0 -5px 20px rgba(0,0,0,0.5);
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: #666;
            font-size: 11px;
            font-weight: bold;
            width: 60px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .nav-icon { font-size: 24px; margin-bottom: 4px; filter: grayscale(100%); transition: 0.2s; }

        /* Stile quando il bottone √® attivo */
        .nav-item.active .nav-icon { 
            filter: grayscale(0%); 
            transform: translateY(-3px);
            text-shadow: 0 0 10px currentColor;
        }
        .nav-item.active { color: white; }

        /* Colori specifici per le icone attive */
        .nav-covo.active   { color: #ad00ff; } /* Viola */
        .nav-caveau.active { color: #ffd700; } /* Oro */
        
    </style>
</head>
<body class="bg-intro">

    <div id="screen-intro">
        <button class="btn-play" onclick="startGame()">PLAY</button>
    </div>

    <div id="screen-game">
        
        <div class="content-area">
            
           <div id="view-covo" class="view active-view">
                
                <div class="hud-top">
                    <div class="stat-box money-box">
                        üí∞ <span id="user-money">0</span> $RAC
                    </div>
                    <div class="stat-box level-box">
                        ‚≠ê Lvl 1
                    </div>
                </div>

                <div class="character-stage">
                    <img src="raccoo_char.png" 
                         alt="Raccoon Character" 
                         class="char-img" 
                         id="hero-char"
                         onclick="tapCharacter()">
                         
                    <div class="speech-bubble" id="char-speech">Let's heist!</div>
                </div>

                <div class="tools-panel">
                    <h3>üîß Workbench</h3>
                    
                    <div class="lockpick-display">
                        <span style="font-size: 24px;">üóùÔ∏è</span>
                        <span id="lockpick-count" class="counter-text">3</span>
                        <span style="color: #aaa; font-size: 14px; margin-left:5px;">/ 6 Max</span>
                    </div>

                    <div class="action-buttons">
                        <button class="btn-action btn-daily" onclick="claimDaily()" id="btn-daily">
                            üéÅ Claim (3)
                        </button>
                        <button class="btn-action btn-ad" onclick="watchAd()">
                            üì∫ Craft (+1)
                        </button>
                    </div>
                </div>

                <style>
                    /* Layout Fix: Flex Column makes it fill height properly */
                    #view-covo {
                        display: flex;
                        flex-direction: column;
                        height: 100%;
                        width: 100%;
                        overflow: hidden;
                    }

                    .hud-top {
                        display: flex;
                        justify-content: space-between;
                        padding: 15px 20px;
                        width: 100%;
                        box-sizing: border-box;
                        z-index: 20; /* Always on top */
                    }

                    /* The Stage fills all available empty space */
                    .character-stage {
                        flex-grow: 1; 
                        display: flex;
                        align-items: center; /* Vertical Center */
                        justify-content: center; /* Horizontal Center */
                        position: relative;
                        width: 100%;
                    }

                    .char-img {
                        width: 65vw; /* Slightly smaller to fit better */
                        max-width: 280px;
                        filter: drop-shadow(0 10px 15px rgba(0,0,0,0.5));
                        animation: float 4s ease-in-out infinite;
                        transition: transform 0.1s;
                        cursor: pointer;
                        z-index: 10;
                    }

                    /* The Panel sits at the bottom naturally now */
                    .tools-panel {
                        background: linear-gradient(to top, rgba(0,0,0,0.9) 0%, rgba(0,0,0,0.6) 50%, transparent 100%);
                        padding: 40px 20px 20px 20px; /* More padding on top for fade effect */
                        width: 100%;
                        box-sizing: border-box;
                        text-align: center;
                        z-index: 15;
                    }

                    .tools-panel h3 {
                        margin: 0 0 10px 0;
                        font-size: 14px;
                        color: #ccc;
                        text-transform: uppercase;
                        letter-spacing: 2px;
                        opacity: 0.8;
                    }

                    /* Speech Bubble Style */
                    .speech-bubble {
                        position: absolute;
                        top: 10%;
                        right: 10%;
                        background: white;
                        color: black;
                        padding: 8px 15px;
                        border-radius: 15px;
                        border-bottom-left-radius: 0;
                        font-weight: bold;
                        font-size: 14px;
                        opacity: 0;
                        transition: opacity 0.3s;
                        pointer-events: none;
                        box-shadow: 0 4px 10px rgba(0,0,0,0.3);
                        z-index: 20;
                    }
                </style>

                <script>
                    // Use window scope variables to avoid re-declaration errors if reloaded
                    window.lockpicks = window.lockpicks || 3;
                    const maxLockpicks = 6;
                    
                    // Update UI immediately on load
                    updateUI();

                    function updateUI() {
                        const countEl = document.getElementById('lockpick-count');
                        if(countEl) countEl.innerText = window.lockpicks;
                    }
                    
                    function tapCharacter() {
                        const char = document.getElementById('hero-char');
                        char.style.transform = "scale(0.95) translateY(5px)";
                        setTimeout(() => char.style.transform = "scale(1) translateY(0)", 100);

                        if(window.Telegram.WebApp.HapticFeedback) {
                            window.Telegram.WebApp.HapticFeedback.impactOccurred('medium');
                        }

                        // 30% chance to speak
                        if(Math.random() > 0.7) showSpeech();
                    }

                    function showSpeech() {
                        const bubble = document.getElementById('char-speech');
                        const phrases = [
                            "Need more lockpicks...", 
                            "I saw a huge bank!", 
                            "Cops are sleeping...", 
                            "Let's get rich!",
                            "My bag is empty :("
                        ];
                        bubble.innerText = phrases[Math.floor(Math.random() * phrases.length)];
                        bubble.style.opacity = 1;
                        setTimeout(() => bubble.style.opacity = 0, 2500);
                    }

                    function claimDaily() {
                        if(window.lockpicks >= maxLockpicks) return;
                        
                        window.lockpicks = Math.min(window.lockpicks + 3, maxLockpicks);
                        updateUI();
                        
                        const btn = document.getElementById('btn-daily');
                        btn.disabled = true;
                        btn.innerText = "‚úÖ Claimed";
                        btn.style.opacity = "0.6";
                        
                        if(window.Telegram.WebApp.HapticFeedback) 
                            window.Telegram.WebApp.HapticFeedback.notificationOccurred('success');
                    }

                    function watchAd() {
                        if(window.lockpicks < maxLockpicks) {
                            window.lockpicks++;
                            updateUI();
                            // Optional: Alert replaced by simple feedback
                        } else {
                            // Shake effect or warning could go here
                        }
                    }
                </script>
            </div>

            <div class="nav-item nav-caveau" onclick="switchTab('caveau')">
                <div class="nav-icon">üíé</div>
                <div>CAVEAU</div>
            </div>

            <div class="nav-item" onclick="alert('Presto in arrivo!')">
                <div class="nav-icon">üó∫Ô∏è</div>
                <div>CITT√Ä</div>
            </div>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        // Funzione per avviare il gioco
        function startGame() {
            if(tg.HapticFeedback) tg.HapticFeedback.impactOccurred('heavy');
            
            // Passa dalla schermata Intro alla schermata Game
            document.getElementById('screen-intro').style.display = 'none';
            document.getElementById('screen-game').style.display = 'flex';
            
            // Imposta subito lo sfondo e la tab del Covo
            switchTab('covo');
        }

        // Funzione GENIALE per gestire le tab
        // tabName deve corrispondere all'ID della vista (es: view-covo) e alla classe sfondo (es: bg-covo)
        function switchTab(tabName) {
            if(tg.HapticFeedback) tg.HapticFeedback.selectionChanged();

            // 1. CAMBIA SFONDO BODY
            // Rimuovi tutte le classi bg- conosciute e metti quella nuova
            document.body.classList.remove('bg-intro', 'bg-covo', 'bg-caveau');
            document.body.classList.add('bg-' + tabName);

            // 2. GESTIONE DEI BOTTONI (NAVBAR)
            // Togli 'active' da tutti i bottoni
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            // Aggiungi 'active' solo al bottone cliccato (cerchiamo quello che contiene la classe nav-tabName)
            const activeBtn = document.querySelector('.nav-' + tabName);
            if(activeBtn) activeBtn.classList.add('active');

            // 3. CAMBIO VISTA CENTRALE
            // Nascondi tutte le viste
            document.querySelectorAll('.view').forEach(el => el.classList.remove('active-view'));
            // Mostra solo quella scelta
            document.getElementById('view-' + tabName).classList.add('active-view');
        }
    </script>
</body>
</html>


